<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Verifikasi Rekapan Arisan</title>

<style>
.watermark-top {
  position: fixed;
  top: 10px;
  right: 15px;
  font-size: 11px;
  color: #666;
  opacity: 0.7;
  font-family: Arial, sans-serif;
  z-index: 9999;
  user-select: none;
}
</style>

</head>
<body>

<div class="watermark-top">
  This system was created by Anang
</div>

<h3>VERIFIKASI REKAPAN ARISAN</h3>
<div id="hasil">Memeriksa...</div>
<div id="pdf"></div>

<script>
const api = "https://script.google.com/macros/s/AKfycbw2jel0gBVQdECoFY-SexA3TDZ-HXtKqr2tMSZkgyeb2SG7j8l6g9NdIsKSjlt7ithVJg/exec";
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

const hasil = document.getElementById("hasil");
const pdf = document.getElementById("pdf");

if (!id) {
  hasil.innerText = "ID TIDAK DITEMUKAN";
} else {
  fetch(api + "?id=" + encodeURIComponent(id))
    .then(r => r.json())
    .then(d => {
      if (d.status === "valid") {
        hasil.innerHTML = `
          <b>REKAPAN SAH</b><br>
          Periode: ${d.periode}<br>
          Kelompok: ${d.kelompok}<br>
          Dana Sehat: ${d.total}<br>
          Dana Arisan: ${d.tanggal}<br>
          
          <hr>

            <p><b>Dibuat oleh:</b>Anang, Pelaksana Arisan RT 007/06<br>
            <p><b>Ditinjau oleh:</b>Darmanto, Pengelola Dana Sehat RT 007/06<br>
            <p><b>Disahkan oleh:</b>Abdul Kadir, Ketua RT 007/06<br>

            <div class="footer">
              Surat ini telah diverifikasi melalui sistem digital RT 007/06.
              <p><i>This system was created by anang</i>
            </div>
          `;

        pdf.innerHTML = `
          <iframe
            src="https://drive.google.com/file/d/${d.fileId}/preview?rm=minimal"
            width="100%" height="600"
            sandbox="allow-scripts allow-same-origin">
          </iframe>
        `;
      } else if (d.status === "dicabut") {
        hasil.innerText = "REKAPAN TELAH DICABUT";
      } else {
        hasil.innerText = "DATA TIDAK SAH";
      }
    })
    .catch(err => {
      hasil.innerText = "GAGAL MENGHUBUNGI SERVER";
      console.error(err);
    });
}
</script>
